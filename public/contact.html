<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>–ö–æ–Ω—Ç–∞–∫—Ç - DiabReg</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f8fb;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #ffffff;
      padding: 30px 40px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
    }

    .logo {
      display: block;
      margin: 0 auto 20px auto;
      max-width: 160px;
    }

    h2 {
      text-align: center;
      color: #0b3a5b;
      margin-bottom: 30px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
      color: #333;
    }

    input[type="email"],
    input[type="text"],
    textarea,
    input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #005fa3;
    }

    @media screen and (max-width: 600px) {
      .container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="logo.jpg" alt="DiabReg –õ–æ–≥–æ" class="logo">

    <h2>–ò—Å–ø—Ä–∞—Ç–∏ –µ-–ø–æ—à—Ç–∞</h2>
	
	<!-- –ò—Å—Ç–æ—Ä–∏—ò–∞ –ö–æ–ø—á–µ -->
<button type="button" onclick="loadHistory()">üìú –ò—Å—Ç–æ—Ä–∏—ò–∞</button>

<!-- Popup –º–æ–¥–∞–ª -->
<div id="historyModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999;">
  <div style="background:white; width:90%; max-width:800px; margin:80px auto; padding:20px; border-radius:10px; overflow:auto; max-height:80%;">
    <h3 style="text-align:center;">–ò—Å—Ç–æ—Ä–∏—ò–∞ –Ω–∞ –∏—Å–ø—Ä–∞—Ç–µ–Ω–∏ –ø–æ—Ä–∞–∫–∏</h3>
    <div id="historyContent">–í—á–∏—Ç—É–≤–∞—ö–µ...</div>
    <div style="text-align:center; margin-top:20px;">
      <button onclick="document.getElementById('historyModal').style.display='none'">–ó–∞—Ç–≤–æ—Ä–∏</button>
    </div>
  </div>
</div>
<BR><BR><BR><BR>
	
    <form action="/send-email" method="POST" enctype="multipart/form-data">
      <label for="to">–î–æ (email –Ω–∞ –ø—Ä–∏–º–∞—á):</label>
      <input type="email" id="to" name="to" required>

      <label for="subject">–ù–∞—Å–ª–æ–≤ (Subject):</label>
      <input type="text" id="subject" name="subject" required>

      <label for="message">–ü–æ—Ä–∞–∫–∞:</label>
      <textarea id="message" name="message" rows="6" required></textarea>

      <label for="attachments">–ü—Ä–∏–∫–∞—á–∏ —Ñ–∞—ò–ª:</label>
      <input type="file" name="attachments" id="attachments" multiple>

      <button type="submit">–ò—Å–ø—Ä–∞—Ç–∏</button>
    </form>
  </div>
<script>
  async function loadHistory() {
    try {
      const response = await fetch('/history.json');
      const history = await response.json();

      if (history.length === 0) {
        document.getElementById('historyContent').innerHTML = '<p>–ù–µ–º–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ –ø—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ.</p>';
      } else {
        let table = '<table border="1" cellpadding="6" cellspacing="0" style="width:100%; border-collapse:collapse;">';
        table += '<tr><th>–î–æ</th><th>Subject</th><th>–ü–æ—Ä–∞–∫–∞</th><th>–ê—Ç–∞—á–º–µ–Ω—Ç–∏</th><th>–î–∞—Ç—É–º</th></tr>';
        history.reverse().forEach(entry => {
          table += `<tr>
            <td>${entry.to}</td>
            <td>${entry.subject}</td>
            <td>${entry.message}</td>
            <td>${entry.attachments.join('<br>')}</td>
            <td>${new Date(entry.date).toLocaleString()}</td>
          </tr>`;
        });
        table += '</table>';
        document.getElementById('historyContent').innerHTML = table;
      }

      document.getElementById('historyModal').style.display = 'block';

    } catch (err) {
      document.getElementById('historyContent').innerHTML = '<p style="color:red;">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ.</p>';
    }
  }
</script>

</body>
</html>
